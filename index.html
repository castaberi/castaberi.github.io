<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Social Data Analysis - Assignment 2</title>
		<script type="text/javascript" src="d3/d3.js"></script>
		<style type="text/css">
						

		.bar {
			fill: steelblue;
			-moz-transition: all 0.3s;
			-o-transition: all 0.3s;
			-webkit-transition: all 0.3s;
			transition: all 0.3s;
		}

		.bar:hover {
			fill: brown;
		}

		.axis text {
			font-family:  'Century Gothic', CenturyGothic, AppleGothic, sans-serif;
			font-size: 11px;
		}

		path {
		  stroke: #555;
		}
		
		.axis path,
		.axis line {
			fill: none;
			stroke: #000;
			shape-rendering: crispEdges;
		}

		.x.axis path {
			display: none;
		}


		h1 {
			font-family: 'Century Gothic', CenturyGothic, AppleGothic, sans-serif;
			font-size: 24px;
			font-style: normal;
			font-variant: normal;
			font-weight: 500;
			line-height: 26.4px;
		}
					
		h2 {
			font-family: 'Century Gothic', CenturyGothic, AppleGothic, sans-serif;
			font-size: 18px;
			font-style: normal;
			font-variant: normal;
			font-weight: 500;
			line-height: 20.4px;
		}

		p {
			font-family: 'Century Gothic', CenturyGothic, AppleGothic, sans-serif;
			font-size: 14px;
			font-style: normal;
			font-variant: normal;
			font-weight: 400;
			line-height: 20px;
		}
		
		.tooltip {
			position: absolute;
			width: 200px;
			height: 28px;
			pointer-events: none;
		}

			
		</style>
		
	</head>
	<body>


		<h2>Assignment 2A: Five modified SVG squares </h2>
		
		<svg width="350" height="150">
			<rect x="0"   y="60" width="80" height="80" fill="purple" stroke="gray" stroke-width="2" opacity="1.0"/> 
			<rect x="55"  y="45" width="80" height="80" fill="blue"   stroke="gray" stroke-width="2" opacity="0.8"/>
			<rect x="110" y="30" width="80" height="80" fill="green"  stroke="gray" stroke-width="2" opacity="0.6"/>
			<rect x="165" y="15" width="80" height="80" fill="yellow" stroke="gray" stroke-width="2" opacity="0.4"/>
			<rect x="220" y="0"  width="80" height="80" fill="red"    stroke="gray" stroke-width="2" opacity="0.2"/>
		</svg>



	
		<h2> Assignment 2B:  Visualisation 1</h2>
		
		<p> The following visualisation shows the ratio between Vehicle Theft and Prostitution crimes in the 10 police districts of the San Francisco Police Department. Large circles indicates that the overall crime ratio of the district is high, while small circles indicate that the overall crime rate in the district is low. <strong>In order to make a fair comparison between crime numbers from 2003 and 2015 the axes were chosen to be the same for both datasets. </strong> To toggle between data from 2003 and 2015, press the buttons below:</p> 
		<div id="scatteroption">
			<input name="2003" 
			   type="button" 
			   value="2003" 
			   onclick="updateScatter(2003)"/>
			<input name="2015" 
			   type="button" 
			   value="2015" 
			   onclick="updateScatter(2015)"/>
		</div>
		<div id="scatter"> </div>
		
		<script type="text/javascript">				
			//Width and height
			var margin = {top: 25, right: 20, bottom: 40, left: 60},
			width = 800 - margin.left - margin.right,
			height = 520 - margin.top - margin.bottom;		
		
			//Setup x
			var xValue = function(d) {return d["Prostitution"]},
				xScale = d3.scale.linear().range([0, width]),
				xMap = function(d) {return xScale(xValue(d));},
				xAxis = d3.svg.axis().scale(xScale).orient("bottom");
			
			//Setup y
			var yValue = function(d) {return d["Theft"]},
				yScale = d3.scale.linear().range([height, 0]),
				yMap = function(d) {return yScale(yValue(d));},
				yAxis = d3.svg.axis().scale(yScale).orient("left");
				
			//Setup r
			var rValue = function(d) {return d["Total"]},
				rScale = d3.scale.linear().range([2, 10]),
				rMap = function(d) {return rScale(rValue(d));};
			
			//Setup fill color
			var cValue1 = function(d) { return d.PdDistrict;},
				color = d3.scale.category10();
				

			//Add the tooltip area to the webpage
			var tooltip = d3.select("body").append("div")
				.attr("class", "tooltip")
				.style("opacity", 0);	
			
			
			//Create SVG element
			var svg1 = d3.select("#scatter").append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
					
			// Insert title
			scattertitle = svg1.append("text")
				.attr("class", "title")
				.attr("x", (width / 2))             
				.attr("y", 0 - (margin.top / 2))
				.attr("text-anchor", "middle")  
				.style("font-size", "16px") 
				.style("text-decoration", "underline");
			scattertitle.text("SF District Crimes (2003)");

			
			function type(d) {
				d.PdDistrict = d.PdDistrict;
				d.Prostitution = +d.Prostitution;
				d.Theft = +d.Theft;
				d.Total = +d.Total;
				d.Year = +d.Year;
				return d;
			}
		

			d3.csv('crimecounts.csv', type, function(error, data) {				
				if (error) throw error;
				var headerRow = Object.keys(data[0]);
				console.log(headerRow);  
				console.log(data);				
				
				//Set scale domains
				xScale.domain([0, d3.max(data, xValue)]);
				yScale.domain([0, d3.max(data, yValue)]);
				rScale.domain([0, d3.max(data, rValue)]);

				//Create X axis
				svg1.append("g")
					.attr("class", "axis")
					.attr("transform", "translate(0," + height + ")")
					.call(xAxis);
				
				//Create Y axis
				svg1.append("g")
					.attr("class", "axis")
					.call(yAxis)
					.append("text")
					.attr("transform", "rotate(-90)")
					.attr("y", 6)
					.attr("dy", ".71em")
					.style("text-anchor", "end");
				
				// Set labels
				svg1.append("text")
				    .attr("font-family", "Century Gothic")
					.attr("font-size", "12px")
					.attr("class", "x label")
					.attr("text-anchor", "end")
					.attr("x", (width + (margin.left + margin.right) )/ 2 + 50)
					.attr("y", height + margin.bottom)
					.text("Number of prostitution crimes");					
				svg1.append("text")
					.attr("font-family", "Century Gothic")
					.attr("font-size", "12px")
					.attr("class", "y label")
					.attr("text-anchor", "end")
					.attr("y", -margin.left-10)
					.attr("x",-height/2+80)
					.attr("dy", ".75em")
					.attr("transform", "rotate(-90)")
					.text("Number of vehicle theft crimes");
					
													
					
										
				// Extract only data from 2003
				data = data.filter(function(row) {
					return row['Year'] == 2003;
				});
				
				// Bind data
				var dots = svg1.selectAll(".dot").data(data);
				
				// Enter
				dots.enter().append("circle")
					.style("fill", function(d) { return color(cValue1(d));})
					.on("mouseover", function(d) {
						tooltip.transition()
							.duration(200)
							.style("opacity", .9);
						tooltip.html(d["PdDistrict"] + "<br/> (" + xValue(d) 
							+ ", " + yValue(d) + ")")
							.style("left", (d3.event.pageX + 5) + "px")
							.style("top", (d3.event.pageY - 25) + "px");
					})
					.on("mouseout", function(d) {
						tooltip.transition()
							.duration(500)
							.style("opacity", 0);
					});
				
				// Update
				dots.attr("cx", xMap)
					.attr("cy", yMap)
					.attr("r", rMap);
								
				// Exit
				dots.exit().remove();

				
				// draw legend
			    var legend = svg1.selectAll(".legend")
					.data(color.domain())
					.enter().append("g")
					.attr("class", "legend")
					.attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

				// draw legend colored rectangles
				legend.append("rect")
					.attr("y", height/2)
					.attr("x", width - 18)
					.attr("width", 18)
					.attr("height", 18)
					.style("fill", color);
					
				// draw legend text
				legend.append("text")
					.attr("x", width - 24)
					.attr("y", height/2 + 9)
					.attr("dy", ".35em")
					.style("text-anchor", "end")
					.text(function(d) { return d;})					
				        .attr("font-family", "Century Gothic")
		  			.attr("font-size", "14px")
			});
		
			
			
			var updateScatter = function(year)
			{
				scattertitle.text("SF District Crimes (" + year + ")")
				d3.csv('crimecounts.csv', type, function(error, data) {
					if (error) throw error;  
					console.log(data);						
									
					// Extract data from specified year
					data =data.filter(function(row) {
						return row['Year'] == year;
					});
					
					// Bind data
					var dots = svg1.selectAll("circle").data(data);
					
					// Enter
					dots.enter().append("circle");
					
					// Update
					dots.transition()
						.duration(2000)
						.attr("cx", xMap)
						.attr("cy", yMap)
						.attr("r", rMap);
							
					// Exit
					dots.exit().remove();						
				});
			}			

			
</script>
	
		<h2>Assignment 2C: Visualisation 2</h2>

		<p> In this visualisation, we look at how the total amount of crimes commited from a certain category across the 13 year span in all San Francisco Police Districts are spread across each year. The height of each bar in the histogram corresponds to the percentage of crimes of that category commited within the corresponding year. To switch between the different focus crimes, press the buttons:</p>
		
		<div id="histoption1">
			<input name="Vehicle theft" 
			   type="button" 
			   value="Vehicle theft" 
			   onclick="updateHist('Vehicle theft')"/>			   
			<input name="Prostitution" 
			   type="button" 
			   value="Prostitution" 
			   onclick="updateHist('Prostitution')"/>
			<input name="Weapon Laws" 
			   type="button" 
			   value="Weapon Laws" 
			   onclick="updateHist('Weapon laws')"/>
			<input name="Driving under the influence" 
			   type="button" 
			   value="Driving under the influence" 
			   onclick="updateHist('Driving under the influence')"/>
			<input name="Robbery" 
			   type="button" 
			   value="Robbery" 
			   onclick="updateHist('Robbery')"/>		
			<input name="Assault" 
			   type="button" 
			   value="Assault" 
			   onclick="updateHist('Assault')"/>		
			<input name="Burglary" 
			   type="button" 
			   value="Burglary" 
			   onclick="updateHist('Burglary')"/>
		</div>
		<div id="histoption2">
			<input name="Drunkenness" 
			   type="button" 
			   value="Drunkenness" 
			   onclick="updateHist('Drunkenness')"/>
			<input name="Drug/narcotic" 
			   type="button" 
			   value="Drug/narcotic" 
			   onclick="updateHist('Drug/narcotic')"/>
			<input name="Trespass" 
			   type="button" 
			   value="Trespass" 
			   onclick="updateHist('Trespass')"/>
			<input name="Larceny/theft" 
			   type="button" 
			   value="Larceny/theft" 
			   onclick="updateHist('Larceny/theft')"/>
			<input name="Vandalism" 
			   type="button" 
			   value="Vandalism" 
			   onclick="updateHist('Vandalism')"/>
			<input name="Stolen property" 
			   type="button" 
			   value="Stolen property" 
			   onclick="updateHist('Stolen property')"/>
			<input name="Disorderly conduct" 
			   type="button" 
			   value="Disorderly conduct" 
			   onclick="updateHist('Disorderly conduct')"/>
		</div>

		<div id="histogram"></div>
		
		<script type="text/javascript">
		
			var margin = {top: 80, right: 20, bottom: 30, left: 40},
			width = 800 - margin.left - margin.right,
			height = 550 - margin.top - margin.bottom;

			var xBar = d3.scale.ordinal()
				.rangeRoundBands([0, width], .1);

			var yBar = d3.scale.linear()
				.range([height, 0]);

			var xAxisBar = d3.svg.axis()
				.scale(xBar)
				.orient("bottom");

			var yAxisBar = d3.svg.axis()
				.scale(yBar)
				.orient("left")
				.ticks(10, "%");

			var svg2 = d3.select("#histogram").append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

			// Insert title
			histtitle = svg2.append("text")
				.attr("class", "title")
				.attr("x", (width / 2))             
				.attr("y", 0 - (margin.top / 2))
				.attr("text-anchor", "middle")  
				.style("font-size", "16px") 
				.style("text-decoration", "underline");
			histtitle.text("Temporal Development of \"Vehicle theft\" Crimes");
				
				
			d3.csv("crimehists.csv", type, function(error, data) {
				if (error) throw error;
				
				
				
				yBar.domain([0, d3.max(data, function(d) { return d.Frequency; })]);
				xBar.domain(data.map(function(d) { return d.Year; }));
			
				// Extract only data
				data = data.filter(function(row) {
					return row['Category'] == "Vehicle theft";
				});
				
			
			
				svg2.append("g")
					.attr("class", "x axis")
					.attr("transform", "translate(0," + height + ")")
					.call(xAxisBar);
					
				svg2.append("g")
					.attr("class", "y axis")
					.call(yAxisBar)
					.append("text")
					.attr("transform", "rotate(-90)")
					.attr("y", 6)
					.attr("dy", ".71em")
					.style("text-anchor", "end")
					.text("Frequency");
					
					
				svg2.selectAll(".bar")
					.data(data)
					.enter().append("rect")
					.attr("class", "bar")
					.attr("x", function(d) { return xBar(d.Year); })
					.attr("width", xBar.rangeBand())
					.attr("y", function(d) { return yBar(d.Frequency); })
					.attr("height", function(d) { return height - yBar(d.Frequency); });									
			});
				
			function type(d) {
				d.Frequency = +d.Frequency;
				return d;
			}
				
				
				
			var updateHist = function(crime)
			{	
				histtitle.text("Temporal Development of \""+crime+"\" Crimes");
			
				d3.csv("crimehists.csv", type, function(error, data) {
					if (error) throw error;
					
					// Extract only data
					data = data.filter(function(row) {
						return row['Category'] == crime;
					});
					
					
					// Bind
					var bars = svg2.selectAll(".bar").data(data);
					
					// Enter
					bars.enter().append("rect");
					
					// Update
					bars.transition()
						.duration(2000)
						.attr("class", "bar")
						.attr("x", function(d) { return xBar(d.Year); })
						.attr("width", xBar.rangeBand())
						.attr("y", function(d) { return yBar(d.Frequency); })
						.attr("height", function(d) { return height - yBar(d.Frequency); })
					
					// Exits
					bars.exit().remove();
									
				});						
			
			
			}
			
		</script>
		
		
		
		<h2>Assignment 2D:Prostitution in San Francisco - K-means clustering</h2>

		<p> Add explicative text here :D</p>
		
		<div id="option">
		<input name="k2" 
		   type="button" 
		   value="k2" 
		   onclick="updateClusters('K2')"/>
		<input name="k3" 
		   type="button" 
		   value="k3" 
		   onclick="updateClusters('K3')"/>
		<input name="k4" 
		   type="button" 
		   value="k4" 
		   onclick="updateClusters('K4')"/>
		<input name="k5" 
		   type="button" 
		   value="k5" 
		   onclick="updateClusters('K5')"/>
		<input name="k6" 
		   type="button" 
		   value="k6" 
		   onclick="updateClusters('K6')"/>
		</div>
		
		<div id="map"></div>
		
		<script type="text/javascript">
		
			//Width and height
			var margin = {top: 80, right: 20, bottom: 30, left: 40},
				width = 800 - margin.left - margin.right,
				height = 550 - margin.top - margin.bottom;
			var rRad = 3;
						
			//Setup fill color
			var cValue = function(d) {return d;},
				color = d3.scale.category10();	

			//Create SVG element
			var svg3 = d3.select("#map")
						.append("svg")
						.attr("width", width)
						.attr("height", height);

			// Insert title
			maptitle = svg3.append("text")
				.attr("class", "title")
				.attr("x", 43)             
				.attr("y", 20)
				.attr("text-anchor", "middle")  
				.style("font-size", "16px") 
				.style("font-weight", "bold")
				.style("text-decoration", "underline");
			maptitle.text("Showing K3");
						
						
			//Define map projection
			var projection = d3.geo.albers()
							.scale(1)
							.translate([0, 0]);

			// Create a path generator.
			var path = d3.geo.path()
						 .projection(projection);


			// Plot map
			d3.json("sfpddistricts.json", function(json) {
				// Compute the bounds of a feature of interest, then derive scale & translate.
				var b = path.bounds(json),
					s = .95 / Math.max((b[1][0] - b[0][0]) / width, (b[1][1] - b[0][1]) / height),
					t = [(width - s * (b[1][0] + b[0][0])) / 2, (height - s * (b[1][1] + b[0][1])) / 2];

				// Update the projection to use computed scale & translate.
				projection
					.scale(s)
					.translate(t);

				//Bind data and create one path per GeoJSON feature
				svg3.selectAll("path")
				   .data(json.features)
				   .enter()
				   .append("path")
				   .attr("d", path)
				   .style("fill", "LightBlue");
			});
	
			// Plot points on map
			d3.csv("data.csv", function(data) {
				svg3.selectAll(".clusterpoints")
				   .data(data)
				   .enter()
				   .append("circle")
				   .attr("class","clusterpoints")
				   .attr("cx", function(d) {
						   return projection([d.lon, d.lat])[0];
				   })
				   .attr("cy", function(d) {
						   return projection([d.lon, d.lat])[1];
				   })
				   .attr("r", rRad)
				   .style("fill", function(d) {return color(cValue(d['K3']));})
				   .style("opacity", 0.75);	
			});
	
	

			
			
			
			// Update functions
			var updateClusters = function(k) {
				maptitle.text("Showing " + k);
				//updateCentres(k);
				updateColours(k);
			}
			
			var updateCentres = function(k) {
				d3.csv("clusters.csv", function(error, data) {
					if (error) throw error;
					 
					data = data.filter(function(row) {
						return row['cluster'] == k;
					});
					 
					var clusters = svg3.selectAll(".centres").data(data);
					 
					clusters.enter().append("circle").attr("class", "centres");
					 
					clusters.transition()
					    .duration(2000)
					    .attr("cx", function(d) {
							return projection([d.lon, d.lat])[0];
					    })
					    .attr("cy", function(d) {
							return projection([d.lon, d.lat])[1];
					    })
					    .attr("r", 10)
					    .style("fill", "black");
								
						// Exit
						//clusters.exit().remove();						   
				});
			}
			
			var updateColours = function(k) {
				svg3.selectAll(".clusterpoints")
					   .transition()
					   .duration(1000)
					   .style("fill", function(d) {return color(cValue(d[k]));});
			}
		
		</script>
		
		<p  align="center" > &copy Social Data Analysis 2016 - Casper, Nina and Marco - DTU </p>
		
	</body>
</html>
